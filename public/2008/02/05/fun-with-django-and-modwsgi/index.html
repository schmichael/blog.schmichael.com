<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Fun with Django and modwsgi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.15" />
  <link href="" rel="alternate" type="application/rss+xml" title="schmichael&#39;s blog" />
  <link href="https://blog.schmichael.com//css/bootstrap.min.css" rel="stylesheet">
  <link href="https://blog.schmichael.com//css/hc.css" rel="stylesheet">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  
    
    </head>
    <body>
<div class="nav-toggle"><i class="fa fa-bars fa-2x"></i> Herring Cove </div>
      <div id = "wrapper">


<div class="navbar navbar-default" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a href="https://blog.schmichael.com//"><p class="navbar-brand">schmichael&#39;s blog</p></a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
					
					
					<li><a href="https://blog.schmichael.com//">Home </a></li>
					
					<li><a href="https://blog.schmichael.com//blog/">Blog </a></li>
					
					<li><a href="https://blog.schmichael.com//about-me/">About </a></li>
					
          </ul>
        </div>
      </div>
    </div>



       
       <div id="sidebar-wrapper">
        <ul class="sidebar-nav">
					<img src="" />
          <li class="sidebar-brand"><a href="https://blog.schmichael.com//"><h1 class="brand">schmichael&#39;s blog</h1></a><h3></h3></li>
          <hr />
					
						<li><a href="https://blog.schmichael.com//">Home </a></li>
					
						<li><a href="https://blog.schmichael.com//blog/">Blog </a></li>
					
						<li><a href="https://blog.schmichael.com//about-me/">About </a></li>
					
          <hr />
          <div id="social-wrapper">
           
           
           
           
         </div>
       </ul>
     </div>



     <div class="container">


  <div id="article">
   <div class="article-title">Fun with Django and modwsgi</div>
   <p class="meta"><small>&nbsp;<i class="fa fa-calendar-o"></i> 2008-02-06</small></p> <hr/>
   <div class="post">
     <p>Today I deployed my first <a href="http://www.djangoproject.com/">Django</a> application for a client. Its yet-another-blog, so I&#8217;ll refrain from posting the code and cluttering up the django-*blog* namespace on Google Code. Before you roll your eyes and complain about why I didn&#8217;t use an existing solution, I think I have 2 somewhat valid reasons:</p>

<ol>
<li>The client actually needed a _sub_set of the features most blogs offer, so I wouldn&#8217;t really have anything to contribute back to an existing project.</li>
<li>Blogs are one of the simplest content driven web applications in existence. Wikis are just a bit simpler perhaps. At any rate, creating a blog app is an excellent way to learn a framework.</li>
</ol>

<p><strong>Python Deployment Decisions</strong></p>

<p>In the past I&#8217;ve used <a href="http://michael.susens-schurter.com/blog/2007/08/16/deploying-cherrypy-on-apache-2-using-mod_proxy/">CherryPy as my framework and a simple mod_proxy configuration to run the applications behind Apache</a>. <a href="http://www.djangoproject.com/documentation/django-admin/#runserver-optional-port-number-or-ipaddr-port">Django considers its built-in web server a development tool only</a>, so I figured it was time to explore the myriad of Python web app deployment alternatives: <a href="http://www.modpython.org">mod_python</a>, <a href="http://www.fastcgi.com/">FastCGI</a>, <a href="http://www.modwsgi.org">modwsgi</a>. I&#8217;m sure there are many more, but I&#8217;d say those are the big 3.</p>

<p>I had tried to deploy Python web applications on DreamHost using FastCGI before and entered <a href="http://www.al3x.net/2008/01/shared-hosting-is-ghetto.html">the hell that is deploying Python web apps on shared hosts</a>. <em>So FastCGI wasn&#8217;t my first choice this time.</em></p>

<p>I had also tried mod_python for deploying <a href="http://www.cherrypy.org/">CherryPy</a> apps on my <a href="http://www.linode.com/">Linode</a> before and for whatever reason just found <a href="http://httpd.apache.org/docs/2.2/mod/mod_proxy.html">mod_proxy</a> to be <em>much</em> easier to setup and manage.</p>

<p>I was kind of eager to try out modwsgi because its been getting a lot of attention lately, so I downloaded the source and compiled it on my <a href="http://www.debian.org/">Debian</a> <a href="http://www.debian.org/releases/etch/">Etch</a> server.</p>

<p><strong>Deploying a Django App via modwsgi</strong></p>

<p>modwsgi was quite easy to setup as long as you follow the instructions in their wiki for Django integration. I was hit by <a href="http://code.djangoproject.com/ticket/3762">bug #3762</a>, but the modwsgi documentation got me through it. <small>(For what its worth the attached wsgi.patch also worked, but I don&#8217;t really want to run a patched version of Django.)</small></p>

<p>One big problem I ran into was <a href="http://docs.python.org/lib/module-sqlite3.html">sqlite3</a> gave me <code>OperationalError: unable to open database file</code> whenever I did anything that would write to the database. My database file was owned by <code>www-data</code> (the Apache process owner) and had the permissions <code>664</code>.</p>

<p>I switched to <a href="http://www.postgresql.org/">PostgreSQL</a>, ran [<code>syncdb</code>][16], and everything worked beautifully.</p>

<p>My wsgi script file /srv/spam/eggs/eggs.wsgi:</p>

<pre lang="python">import os, sys
sys.path.append('/srv/spam')
sys.path.append('/srv/spam/eggs')
os.environ['DJANGO_SETTINGS_MODULE'] = 'eggs.wsgi_settings'

import django.core.handlers.wsgi

_application = django.core.handlers.wsgi.WSGIHandler()

def application(environ, start_response):
    environ['PATH_INFO'] = environ['SCRIPT_NAME'] + environ['PATH_INFO']
    return _application(environ, start_response)
</pre>

<p>Note I use <code>wsgi_settings</code> instead of my usual settings file. wsgi_settings just imports my main settings file and changes some to their production values.</p>

<p>My Django application actually drops into the <code>/blog/</code> and <code>/accounts/</code> folders under a VirtualHost otherwise occupied by static files and some PHP scripts. modwsgi made this easy by putting this in my existing VirtualHost:</p>

<pre lang="apache">WSGIScriptAliasMatch /(blog|accounts)/.* /srv/spam/eggs/eggs.wsgi

# A simple Alias directive handles my static files
Alias /static/ /srv/spam/eggs/static/
</pre>

<p><strong>Bottom Line</strong></p>

<p>I highly recommend using modwsgi for deploying Python web applications. sqlite3 may work for you. In my case its probably best I use PostgreSQL for a number of reasons.</p>

<p>[16]: <a href="http://www.djangoproject.com/documentation/django-admin/#syncdb">http://www.djangoproject.com/documentation/django-admin/#syncdb</a></p>

   </div>
 </div>


 <a href="https://twitter.com/share" class="twitter-share-button " data-size="small" data-count="none">Tweet</a>
 <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

 <ul class="pager">
      &nbsp;<li class="previous"><a href="https://blog.schmichael.com/2008/02/17/permanent-home-for-firewall-admin/"> Permanent home for firewall-admin</a></li>
      &nbsp;<li class="next"><a href="https://blog.schmichael.com/2008/01/30/hostname-tab-completion-for-openssh/"> Hostname Tab-Completion for OpenSSH</a></li>
</ul>



    </ul>
    </div>
    <footer>

        <p class="text-muted credit">&copy; . All rights reserved. </p>
    </footer>
 
    <script src="/js/jquery-1.10.2.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/bootstrap.js"></script>
    <script type="text/javascript" src="/js/hc.js"></script>
</body>

</html>

